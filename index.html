<!DOCTYPE html> <html> <head> <title>Canvas / Javascript Game Template</title> </head> <body> <style type="text/css"> html, body { margin: 0; padding: 0; font-size: 10px; } body { font-family: Calibri, 'Myriad Web Pro', sans-serif; background-color: #333333; color: #aaaaaa; } h1, h2, h3, h4, h5, h6 { text-shadow: 0 -1px 0 #bbbbbb; margin: 0; font-size: 250%; } header { margin: 3px 8px; } canvas { display: block; margin-left: auto; margin-right: auto; background-color: black; } </style> <canvas id="main-canvas" onclick=" var b = new Ball(); if (Math.random() > 0.8) b = new Predator(); b.position = {x: Math.random() * 800 + 50, y: Math.random() * 400 + 50}; if (b.size.m > 25) b.color = '#0000ff'; b.pick_destination(); game.objects.push(b);"></canvas> <script type="text/javascript" src="ball.js"></script> <script type="text/javascript"> function r(d) { return d * (Math.PI / 180); } function d_to(p1, p2) { return Math.floor(Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI); } function dist(p1, p2) { var a = p1.x - p2.x; var b = p1.y - p2.y; return Math.abs(Math.sqrt( a * a + b * b)); } function forward(pos, dist, angle) { pos.x += dist * Math.cos(r(angle)); pos.y += dist * Math.sin(r(angle)); } function overlap(o1, o2, s1, s2) { return (o1.x + s1 > o2.x && o1.x < o2.x + s2 && o1.y + s1 > o2.y && o1.y < o2.y + s2) } // Sample object to draw on screen var Projectile = function(from, destination, owner) { this.type = "Projectile"; this.position = {x:from.x, y:from.y}; this.destination = {x:destination.x, y:destination.y}; this.facing = d_to(this.position, this.destination); this.turn_rate = 0; this.acceleration = 0; this.friction = 0.0000001; this.max_speed = 5 this.size = {l:2, w:2, m:2}; this.owner = owner; this.speed = {x:1, y:1, t:this.max_speed}; this.color = "#ff0000"; } Projectile.prototype = new Ball(); Projectile.prototype.destination_update = function() { } Projectile.prototype.act = function() {}; Projectile.prototype.react = function() {}; Projectile.prototype.meet = function(target, game) { if (this.is_at(target.position, target.target_size) && target.type == "Agent" && target != this.owner) target.active = 0; } Projectile.prototype.draw = function(ctx) { if (this.speed.t <= this.max_speed / 3) { this.active = 0; } if (!this.active) return; ctx.fillStyle = this.color; ctx.beginPath(); ctx.rect(this.position.x - this.size.m, this.position.y - this.size.m, this.size.m, this.size.m); ctx.closePath(); ctx.fill(); } var Predator = function() { this.max_speed = 5; this.turn_rate = 7; this.acceleration = 0.4; this.size.m = 9; this.color = "#ffff00"; this.sight_range = 800; this.derpy = 3; this.projectile_color = "#aaaa00"; } Predator.prototype = new Ball(); Predator.prototype.pick_destination = function() { this.destination = { x:Math.random() * 800 + this.size.m + 50, y:Math.random() * 400 + this.size.m + 50 }; if (this.target && this.target.active) { this.destination = { x: this.target.position.x + Math.random() * 30, y: this.target.position.y + Math.random() * 30}; if (Math.random() > 0.5) this.destination.x -= 45; if (Math.random() > 0.5) this.destination.y -= 45; } } Predator.prototype.is_at = function(position) { return dist(this.position, this.destination) < 100 || (this.target && dist(this.position, this.target.position) < 100); }; Predator.prototype.destination_update = function() { var destination_angle = d_to(this.position, this.destination); if (this.is_at(this.destination)) { this.pick_destination(); this.throttle = 0; } else if (this.facing - this.derpy >= destination_angle) { this.facing -= this.turn_rate; this.throttle = 0; } else if (this.facing + this.derpy <= destination_angle){ this.facing += this.turn_rate; this.throttle = 0; } if (Math.abs(Math.abs(this.facing) - Math.abs(destination_angle)) < this.derpy * 2) { this.throttle = 1; } } var game = { canvasId: 'main-canvas', canvas: null, ctx: null, objects: [], init: function() { window.reqFrame = (function(){ return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function(callback){ window.setTimeout(callback, 1000 / 60); } })(); game.canvas = document.getElementById(game.canvasId); game.ctx = game.canvas.getContext('2d'); game.setCanvasSizeToWindow(); for (var j = 0; j < 2; j++) { var b = new Ball(); b.position = {x: Math.random() * 800 + 50, y: Math.random() * 400 + 50}; if (b.size.m > 25) b.color = "#0000ff"; b.pick_destination(); game.objects.push(b); } game.objects.push(new Predator()); game.main(); }, setCanvasSizeToWindow: function() { game.canvas.width = window.innerWidth; game.canvas.height = window.innerHeight; }, main: function() { // The main loop called when a new animation frame is requested game.update(); game.clearCanvas(); game.draw(); reqFrame(game.main); }, clearCanvas: function() { game.ctx.clearRect(0, 0, game.canvas.width, game.canvas.height); }, update: function() { // Sample object updating code for (var obj in game.objects) { game.objects[obj].update(game); } }, draw: function() { // Sample object drawing code for (var obj in game.objects) { game.objects[obj].draw(game.ctx); } } }; game.init(); </script> </body> </html>